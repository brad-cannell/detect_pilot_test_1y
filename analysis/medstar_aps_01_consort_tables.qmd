---
title: "Consort Tables"
format: html
#editor: visual
---

# Summary

-   There were 16,565 Subjects in the MedStar data set

    -   1,967 Subjects were also present in the APS data set

    -   492 Responses had a paired intake from the APS data set, representing 461 APS Case Numbers

-   Data was taken from the Response-Intake row-paired data

    -   28,228 Responses represented an individual eligible for DETECT screening

    -   24,007 Responses were screened with the DETECT tool

        -   871 of these had a positive screening

            -   328 of these positive screenings were reported

                -   273 of these reports had a matching APS Intake

                    -   226 of these Intakes were associated with an APS Case Number with at least 1 Valid Allegation of Elder Mistreatment, and 247 were associated with a Subject with at least 1 Valid Allegation of Elder Mistreatment across the entire APS data set

                    -   47 of these Intakes were associated with an APS Case Number with no Valid Allegation of Elder Mistreatment, and 26 were associated with a Subject with at no Allegation of Elder Mistreatment across the entire APS data set

                -   55 of these reports did not have a matching APS Intake

                    -   25 of these Intakes were associated with a Subject with at least 1 Valid Allegation of Elder Mistreatment across the entire APS data set

                    -   2 of these Intakes were associated with a Subject with at no Allegation of Elder Mistreatment across the entire APS data set

                    -   28 were associated with a Subject that was not present in the APS data set

            -   541 of these positive screenings were not reported

                -   48 of these screenings had a matching APS Intake

                    -   42 of these Intakes were associated with an APS Case Number with at least 1 Valid Allegation of Elder Mistreatment, and 43 were associated with a Subject with at least 1 Valid Allegation of Elder Mistreatment across the entire APS data set

                    -   6 of these Intakes were associated with an APS Case Number with no Valid Allegation of Elder Mistreatment, and 5 were associated with a Subject with at no Allegation of Elder Mistreatment across the entire APS data set

                    -   493 of these screenings did not have a matching APS Intake

                        -   144 of these Intakes were associated with a Subject with at least 1 Valid Allegation of Elder Mistreatment across the entire APS data set

                        -   24 of these Intakes were associated with a Subject with at no Allegation of Elder Mistreatment across the entire APS data set

                        -   325 were associated with a Subject that was not present in the APS data set

                -   2 of these positive screenings were missing any indication of if they were or were not reported

                    -   1 of these reports was associated with a Subject with at least 1 Valid Allegation of Elder Mistreatment across the entire APS data set

                    -   1 of these reports was associated with a Subject that was not present in the APS data set

        -   23,136 of these had a negative screening

            -   10 of these negative screenings were reported

                -   7 of these reports had a matching APS Intake

                    -   5 of these Intakes were associated with an APS Case Number with at least 1 Valid Allegation of Elder Mistreatment, and 6 were associated with a Subject with at least 1 Valid Allegation of Elder Mistreatment across the entire APS data set

                    -   2 of these Intakes were associated with an APS Case Number with no Valid Allegation of Elder Mistreatment, and 1 was associated with a Subject with at no Allegation of Elder Mistreatment across the entire APS data set

            -   3 of these reports did not have a matching APS Intake

                -   All 3 were associated with a Subject that was not present in the APS data set

            -   23,106 of these negative screenings were not reported

                -   136 of these screenings had a matching APS Intake

                    -   97 of these Intakes were associated with an APS Case Number with at least 1 Valid Allegation of Elder Mistreatment, and 110 were associated with a Subject with at least 1 Valid Allegation of Elder Mistreatment across the entire APS data set

                    -   39 of these Intakes were associated with an APS Case Number with no Valid Allegation of Elder Mistreatment, and 26 were associated with a Subject with at no Allegation of Elder Mistreatment across the entire APS data set

            -   22,970 of these screenings did not have a matching APS Intake

                -   2,785 of these Intakes were associated with a Subject with at least 1 Valid Allegation of Elder Mistreatment across the entire APS data set

                -   1,123 of these Intakes were associated with a Subject with at no Allegation of Elder Mistreatment across the entire APS data set

                -   19,062 were associated with a Subject that was not present in the APS data set

        -   20 of these positive screenings were missing any indication of if they were or were not reported

            -   1 of these reports was associated with a Subject with at least 1 Valid Allegation of Elder Mistreatment across the entire APS data set

            -   19 of these reports were associated with a Subject that was not present in the APS data set

    -   4,221 Responses were not screened with the DETECT tool

        -   28 of these Responses had a matching APS Intake

            -   24 of these Intakes were associated with an APS Case Number with at least 1 Valid Allegation of Elder Mistreatment, and 24 were associated with a Subject with at least 1 Valid Allegation of Elder Mistreatment across the entire APS data set

            -   4 of these Intakes were associated with an APS Case Number with no Valid Allegation of Elder Mistreatment, and 4 were associated with a Subject with at no Allegation of Elder Mistreatment across the entire APS data set

            -   4,193 of these Responses did not have a matching APS Intake

                -   662 of these Intakes were associated with a Subject with at least 1 Valid Allegation of Elder Mistreatment across the entire APS data set

                -   231 of these Intakes were associated with a Subject with at no Allegation of Elder Mistreatment across the entire APS data set

                -   3,300 were associated with a Subject that was not present in the APS data set

-   Data was taken from the Subject-Based aggregate data set

    -   There were 16,565 subjects eligible for screening, of which 15,212 were screened at least once

        -   Of these, 749 subjects had at least one positive screen

            -   Of these, 293 were reported at least once

                -   238 of these reported subjects were associated with at least one valid allegation

                -   27 of these reported subjects were not associated with any valid allegation

                -   28 of these reported subjects were not present in the APS data set

            -   Of these, 456 were not reported

                -   116 of these subjects were associated with at least one valid allegation

                -   27 of these subjects were not associated with any valid allegation

                -   313 of these subjects were not present in the APS data set

        -   Of these, 14,912 subjects had no positive screens

            -   Of these, 7 were reported at least once

                -   3 of these reported subjects were associated with at least one valid allegation

                -   1 of these reported subjects was not associated with any valid allegation

                -   3 of these reported subjects were not present in the APS data set

            -   Of these, 14,456 were not reported

                -   906 of these subjects were associated with at least one valid allegation

                -   542 of these subjects were not associated with any valid allegation

                -   13,008 of these subjects were not present in the APS data set

    -   1,353 subjects were not screened with the DETECT tool

        -   Of these, none were reported

        -   68 of these subjects were associated with at least one valid allegation

        -   39 of these subjects were not associated with any valid allegation

        -   1,246 of these subjects were not present in the APS data set

# Imports

## Library Imports

```{r}
#| message: false
#| warning: false

library(tidyverse)
library(here)
library(lubridate)
```

## Data Imports

We imported the MedStar data set that included paired APS Intakes for processing.

```{r}
ms_paired <- readRDS(here("data", "02 Shared Folders", "DETECT Shared GRAs","merge_aps_medstar",
                "medstar_aps_merged_02_response_based_row_pairs.rds"))
```

We imported the data set which included a summary for each Subject present in both data sets.

```{r}
subj_data <- readRDS(here("data", "02 Shared Folders", "DETECT Shared GRAs","merge_aps_medstar",
                         "medstar_aps_merged_03_single_subject_per_row.rds"))
```




## Functions

### Unique Value Summary

A function written in a previous cleaning document was imported. It was written to display counts of each unique observations within a selection of columns.

```{r}
get_unique_value_summary <- function(df,cols){
  
  # Input: 
  #     df (data frame) - original source data frame
  #     cols (list) - list of target column names as strings
  # Output:
  #     unique_summary (data frame) - summary counts of each unique value in
  #           each of the target columns
  
  # Get list of unique values in all target columns
  
  df <- df %>%
    mutate(across(everything(), as.character))
  
  val <- unique(as.factor(as.vector(as.matrix(df[cols]))))
  
  # Initialize output data frame with unique value row
  
  unique_summary <- data.frame("value"=val)
  
  # Get counts of unique values in original data frame
  
  for (i in cols){
    
    # utilizes table to get summary count of each column
    
    table <- as.data.frame(table(df[i]))
    
    # sets column names to "value" and "freq"
    
  colnames(table) <- c("value","freq")
  
    # adds count of missing values in each column
  
  table<- add_row(table, value = NA, freq = sum(is.na(df[i])))
  
    # readjusts names of columns to "value" and the name of the target column
  
  colnames(table) <- c("value",i)
  
    # joins table's summary counts to complete the count values
  
    unique_summary <- left_join(unique_summary,table, by="value")
  }
  
  # returns completed, but unordered, data frame
  
  unique_summary
  }
```

# Modification of "APS Report Number" Fields

The value of the DETECT field containing an APS report number was modified to a character factor, indicating if there was or was not an APS Report Number (rather than the actual alphanumeric string APS report number).

```{r}
ms_paired <- ms_paired %>%
  mutate(detect_report_num = if_else(!is.na(detect_report_num), 
                                     "YES", NA_character_)
         ) %>%
  mutate(detect_report_num = as.factor(detect_report_num))
```

# Generation of Restricted Pairing Set for Sensitivity

As multiple reporters were considered potentially valid in initial APS Intake-MedStar Response pairing, a secondary set was generated which would only include the APS Intake and Case-level data for APS Intakes which explicitly had an "EMS/EMT" reporter type.

```{r}
ms_ems <- ms_paired %>%
  mutate(aps_row = ifelse(
    aps_reporter != "Health Care Providers/Staff -- EMS/EMT", 
    NA_integer_, 
    aps_row)
    ) %>%
  mutate(aps_case_num = ifelse(is.na(aps_row), NA_integer_, aps_case_num),
         aps_cases_any_valid = ifelse(is.na(aps_row), NA, aps_cases_any_valid))
```

# Individual Intakes

## Overview

There were a total of 28,228 MedStar Responses in our data set. This represented 16,565 Subjects, 1,967 of which were also represented in the APS data set. There were 492 Responses with a paired APS Intake, which represented 461 APS Case Numbers.

```{r}
nrow(ms_paired)
length(unique(ms_paired$id))

temp_df <- ms_paired %>%
  filter(!is.na(aps_person_id))

length(unique(na.omit(temp_df$aps_person_id)))

temp_df <- temp_df %>%
  filter(!is.na(aps_row))

nrow(temp_df)
length(unique(na.omit(temp_df$aps_case_num)))
```

When examining only for explicit EMS/EMT Intakes, we had 278 Responses with a paired APS Intake, which represented 266 APS Case Numbers.

```{r}
temp_df <- ms_ems %>%
  filter(!is.na(aps_row))

nrow(temp_df)
length(unique(na.omit(temp_df$aps_case_num)))
```

## Screen vs No Screen

We isolated our DETECT Questionnaire variables into four groups: the variables relating to comments entered into the "Report Number" field that were not strictly a report number, the DETECT Tool questions, the DETECT Report determination with the DETECT Tool questions, and all the variables presented as part of the DETECT screening.

### Selecting Variables

```{r}
detect_comment_vars <- ms_paired %>%
  select(detect_report_comment, detect_report_aps_unable, 
         detect_report_aps_onscene, detect_report_aps_existing, 
         detect_facility, detect_other_reporter, detect_uta
         ) %>%
  names()

detect_questions <- ms_paired %>%
  select(detect_env_odor, detect_env_hoarding, detect_env_concern, 
         detect_env_isolated, detect_cond_hygiene, detect_cond_clothes, 
         detect_cond_needs, detect_cond_anxious ,detect_meds_hoarding, 
         detect_meds_difficulty, detect_caregiver_lack, 
         detect_caregiver_inattentive, detect_caregiver_frustrated, 
         detect_caregiver_anxious) %>%
  names()

detect_items <- c(detect_questions, "detect_report_made")

screen_vars <- c(detect_items, "detect_report_num")
```

There were 4,221 Observations without a single DETECT Tool variable entered. This included 2,769 Subjects. There were 28 paired APS Intakes for these observations, representing 27 APS Case Numbers.

```{r}
no_screen <- ms_paired %>%
  filter(!detect_screened)

nrow(no_screen)

length(unique(no_screen$id))
length(unique(na.omit(no_screen$aps_row)))
length(unique(na.omit(no_screen$aps_case_num)))
```

When looking specifically only for explicit EMS/EMT APS Intakes, we had 7 paired APS Intakes representing 7 APS Case Numbers.

```{r}
ems_no_screen <- ms_ems %>%
  filter(!detect_screened)

nrow(ems_no_screen)

length(unique(ems_no_screen$id))
length(unique(na.omit(ems_no_screen$aps_row)))
length(unique(na.omit(ems_no_screen$aps_case_num)))
```

There were 24,007 Observations with at least one DETECT Tool variable entered (inclusive of APS Report Number and if a report was made). This included 15,212 Subjects. There were 464 paired APS Intakes for these observations, representing 437 APS Case Numbers.

```{r}
screened <- ms_paired %>%
  filter(detect_screened)

nrow(screened)

length(unique(screened$id))
length(unique(na.omit(screened$aps_row)))
length(unique(na.omit(screened$aps_case_num)))
```

When looking specifically only for explicit EMS/EMT APS Intakes, we had 271 paired APS Intakes representing 259 APS Case Numbers.

```{r}
ems_screened <- ms_ems %>%
  filter(detect_screened)

nrow(ems_screened)

length(unique(ems_screened$id))
length(unique(na.omit(ems_screened$aps_row)))
length(unique(na.omit(ems_screened$aps_case_num)))
```

Of the 24,007 Responses with at least one DETECT question completed, 336 indicated a report was made, 23,649 indicated no report was made, and 22 did not indicate if a report was or was not made (missing value).

```{r}
get_unique_value_summary(screened, 'detect_report_made')
```

## Screened Positive

A screening was considered positive if at least one of the DETECT variables (not including that a report was made, or a report number) was selected as "YES". This included 871 observations of 749 Subjects. There were 321 paired APS Intakes for these observations, representing 307 APS Case Numbers.

```{r}
checking <- screened %>%
  filter(detect_positive)

nrow(checking)
length(unique(checking$id))
length(unique(na.omit(checking$aps_row)))
length(unique(na.omit(checking$aps_case_num)))
```

When looking specifically only for explicit EMS/EMT APS Intakes, we had 262 paired APS Intakes representing 252 APS Case Numbers.

```{r}
ems_checking <- ems_screened %>%
  filter(detect_positive)

nrow(ems_checking)
length(unique(ems_checking$id))
length(unique(na.omit(ems_checking$aps_row)))
length(unique(na.omit(ems_checking$aps_case_num)))
```

Of these positive screenings, 327 indicated a report was made, 542 indicated a report was *not* made, and 2 did not indicate if a report was or was not made (missing value).

```{r}
get_unique_value_summary(checking, 'detect_report_made')
```

### Reported

The Positive Screenings where it was either indicated a report was made or a report number was recorded in the DETECT tool were further isolated. This included 328 observations of 292 Subjects. There were 273 paired APS Intakes for these observations, representing 262 APS Case Numbers.

```{r}
checking_subset <- checking %>%
  filter(detect_report_made == "YES" | detect_report_num == "YES")

nrow(checking_subset)
length(unique(checking_subset$id))
length(unique(na.omit(checking_subset$aps_row)))
length(unique(na.omit(checking_subset$aps_case_num)))
```

When looking specifically only for explicit EMS/EMT APS Intakes, we had 239 paired APS Intakes representing 230 APS Case Numbers.

```{r}
ems_checking_subset <- ems_checking %>%
  filter(detect_report_made == "YES" | detect_report_num == "YES")

nrow(ems_checking_subset)
length(unique(ems_checking_subset$id))
length(unique(na.omit(ems_checking_subset$aps_row)))
length(unique(na.omit(ems_checking_subset$aps_case_num)))
```

This subset included a single observation which indicated a report was not made, but provided an APS Report Number. This observation was manually verified. As the comments of the APS Report indicated a new report was made, the observation was kept in this subset.

```{r}
get_unique_value_summary(checking_subset, 'detect_report_made')
```

#### All Paired Intakes

The 273 reported observations with a paired APS Intake were further isolated. This subset contained 245 Subjects and 262 APS Case Numbers.

```{r}
checking_subset2 <- checking_subset %>%
  filter(!is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_case_num)))
```

Within this subset, 226 observations referenced an APS Case Number that had at least one valid determination of elder mistreatment, and 47 observations did not. More broadly, there were 247 observations that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 26 were not.

```{r}
get_unique_value_summary(checking_subset2, c('aps_cases_any_valid','aps_subject_any_valid'))
```

The 55 remaining reported observations without a paired APS Intake were further isolated. This subset contained 54 Subjects.

```{r}
checking_subset2 <- checking_subset %>%
  filter(is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_person_id)))
sum(!is.na(checking_subset2$aps_subject_any_valid))
```

Within this subset, there were 25 observations that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 2 were not. The remaining 28 observations did not have any determinations made at the subject level, as they were missing from the APS data set.

```{r}
get_unique_value_summary(checking_subset2, c('aps_subject_any_valid'))
```

```{r}
sum(is.na(checking_subset2[
  is.na(checking_subset2$aps_subject_any_valid),]$aps_person_id)) == 
  sum(is.na(checking_subset2$aps_subject_any_valid))
```

#### EMS/EMT Intakes Only

The 239 reported observations with a paired EMS/EMT APS Intake were further isolated. This subset contained 219 Subjects and 230 APS Case Numbers.

```{r}
checking_subset2 <- ems_checking_subset %>%
  filter(!is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_case_num)))
```

Within this subset, 201 observations referenced an APS Case Number that had at least one valid determination of elder mistreatment, and 38 observations did not. More broadly, there were 220 observations that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 19 did not.

```{r}
get_unique_value_summary(checking_subset2, c('aps_cases_any_valid','aps_subject_any_valid'))
```

The 89 remaining reported observations without a paired APS Intake were further isolated. This subset contained 58 Subjects.

```{r}
checking_subset2 <- ems_checking_subset %>%
  filter(is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_person_id)))
sum(!is.na(checking_subset2$aps_subject_any_valid))
```

Within this subset, there were 52 observations that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 9 did not. The remaining 28 observations did not have any determinations made at the subject level, as they were missing from the APS data set.

```{r}
get_unique_value_summary(checking_subset2, c('aps_subject_any_valid'))
```

```{r}
sum(is.na(checking_subset2[
  is.na(checking_subset2$aps_subject_any_valid),]$aps_person_id)) == 
  sum(is.na(checking_subset2$aps_subject_any_valid))
```

### Not Reported

The Positive Screenings where it was indicated that a report was *not* made and no report number was recorded in the DETECT tool were further isolated. This included 542 observations of 493 Subjects. There were 48 paired APS Intakes for these observations, representing 48 APS Case Numbers.

```{r}
checking_subset <- checking %>%
  filter(detect_report_made == "NO" & is.na(detect_report_num))

nrow(checking_subset)
length(unique(checking_subset$id))
length(unique(na.omit(checking_subset$aps_row)))
length(unique(na.omit(checking_subset$aps_case_num)))
```

When looking specifically only for explicit EMS/EMT APS Intakes, we had 23 paired APS Intakes representing 23 APS Case Numbers.

```{r}
ems_checking_subset <- ems_checking %>%
  filter(detect_report_made == "NO" & is.na(detect_report_num))

nrow(ems_checking_subset)
length(unique(ems_checking_subset$id))
length(unique(na.omit(ems_checking_subset$aps_row)))
length(unique(na.omit(ems_checking_subset$aps_case_num)))
```

#### All Paired Intakes

The 48 non-reported observations with a paired APS Intake were further isolated. This subset contained 47 Subjects and 48 APS Case Numbers.

```{r}
checking_subset2 <- checking_subset %>%
  filter(!is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_case_num)))
```

Within this subset, 42 observations referenced an APS Case Number that had at least one valid determination of elder mistreatment, and 6 observations did not. More broadly, there were 43 observations that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 5 were not.

```{r}
get_unique_value_summary(checking_subset2, c('aps_cases_any_valid','aps_subject_any_valid'))
```

The 493 remaining reported observations without a paired APS Intake were further isolated. This subset contained 458 Subjects.

```{r}
checking_subset2 <- checking_subset %>%
  filter(is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_person_id)))
sum(!is.na(checking_subset2$aps_subject_any_valid))
```

Within this subset, there were 144 observations that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 24 were not. The remaining 325 observations did not have any determinations made at the subject level, as they were missing from the APS data set.

```{r}
get_unique_value_summary(checking_subset2, c('aps_subject_any_valid'))
```

```{r}
sum(is.na(checking_subset2[
  is.na(checking_subset2$aps_subject_any_valid),]$aps_person_id)) == 
  sum(is.na(checking_subset2$aps_subject_any_valid))
```

#### EMS/EMT Intakes Only

The 23 non-reported observations with a paired EMS/EMT APS Intake were further isolated. This subset contained 23 Subjects and 23 APS Case Numbers.

```{r}
checking_subset2 <- ems_checking_subset %>%
  filter(!is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_case_num)))
```

Within this subset, 20 observations referenced an APS Case Number that had at least one valid determination of elder mistreatment, and 3 observations did not. More broadly, there were 20 observations that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 3 did not.

```{r}
get_unique_value_summary(checking_subset2, c('aps_cases_any_valid','aps_subject_any_valid'))
```

The 519 remaining reported observations without a paired APS Intake were further isolated. This subset contained 478 Subjects.

```{r}
checking_subset2 <- ems_checking_subset %>%
  filter(is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_person_id)))
sum(!is.na(checking_subset2$aps_subject_any_valid))
```

Within this subset, there were 167 observations that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 26 did not. The remaining 325 observations did not have any determinations made at the subject level, as they were missing from the APS data set.

```{r}
get_unique_value_summary(checking_subset2, c('aps_subject_any_valid'))
```

```{r}
sum(is.na(checking_subset2[
  is.na(checking_subset2$aps_subject_any_valid),]$aps_person_id)) == 
  sum(is.na(checking_subset2$aps_subject_any_valid))
```

### Missing Indicator of Report

The Positive Screenings where it was neither indicated a report was or was not made (missing value) nor had a report number recorded in the DETECT tool were further isolated. This included 2 observations of 2 Subjects. There were no paired APS Intakes for these observations.

```{r}
checking_subset <- checking %>%
  filter(is.na(detect_report_made) & is.na(detect_report_num))

nrow(checking_subset)
length(unique(checking_subset$id))
length(unique(na.omit(checking_subset$aps_row)))
length(unique(na.omit(checking_subset$aps_case_num)))
```

Within this subset, there was 1 observation that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response). The remaining observation did not have any determinations made at the subject level, as the subject was missing from the APS data set.

```{r}
get_unique_value_summary(checking_subset, c('aps_subject_any_valid'))
```

## Screened Negative

A screening was considered negative if at least of the DETECT variables (not including that a report was made, or a report number) was selected, but no variable was selected as "YES". This included 23,136 observations of 148,881 Subjects. There were 143 paired APS Intakes for these observations, representing 137 APS Case Numbers.

```{r}
checking <- screened %>%
  filter(!detect_positive)

nrow(checking)
length(unique(checking$id))
length(unique(na.omit(checking$aps_row)))
length(unique(na.omit(checking$aps_case_num)))
```

When looking specifically only for explicit EMS/EMT APS Intakes, we had 9 paired APS Intakes representing 9 APS Case Numbers.

```{r}
ems_checking <- ems_screened %>%
  filter(!detect_positive)

nrow(ems_checking)
length(unique(ems_checking$id))
length(unique(na.omit(ems_checking$aps_row)))
length(unique(na.omit(ems_checking$aps_case_num)))
```

Of these negative screenings, 9 indicated a report was made, 23,107 indicated a report was *not* made, and 20 did not indicate if a report was or was not made (missing value).

```{r}
get_unique_value_summary(checking, 'detect_report_made')
```

### Reported

The Negative Screenings where it was either indicated a report was made or a report number was recorded in the DETECT tool were further isolated. This included 10 observations of 10 Subjects. There were 7 paired APS Intakes for these observations, representing 7 APS Case Numbers.

```{r}
checking_subset <- checking %>%
  filter(detect_report_made == "YES" | detect_report_num == "YES")

nrow(checking_subset)
length(unique(checking_subset$id))
length(unique(na.omit(checking_subset$aps_row)))
length(unique(na.omit(checking_subset$aps_case_num)))
```

When looking specifically only for explicit EMS/EMT APS Intakes, we had 5 paired APS Intakes representing 5 APS Case Numbers.

```{r}
ems_checking_subset <- ems_checking %>%
  filter(detect_report_made == "YES" | detect_report_num == "YES")

nrow(ems_checking_subset)
length(unique(ems_checking_subset$id))
length(unique(na.omit(ems_checking_subset$aps_row)))
length(unique(na.omit(ems_checking_subset$aps_case_num)))
```

This subset included a single observation which indicated a report was not made, but provided an APS Report Number. This observation was manually verified. As the comments of the APS Report indicated a new report was made, the observation was kept in this subset.

```{r}
get_unique_value_summary(checking_subset, 'detect_report_made')
```

#### All Paired Intakes

The 7 reported observations with a paired APS Intake were further isolated. This subset contained 7 Subjects and 7 APS Case Numbers.

```{r}
checking_subset2 <- checking_subset %>%
  filter(!is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_case_num)))
```

Within this subset, 5 observations referenced an APS Case Number that had at least one valid determination of elder mistreatment, and 2 observations did not. More broadly, there were 6 observations that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 1 did not.

```{r}
get_unique_value_summary(checking_subset2, c('aps_cases_any_valid','aps_subject_any_valid'))
```

The 3 remaining reported observations without a paired APS Intake were further isolated. This subset contained 3 Subjects.

```{r}
checking_subset2 <- checking_subset %>%
  filter(is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_person_id)))
sum(!is.na(checking_subset2$aps_subject_any_valid))
```

Within this subset, none of the 3 observations had any determinations made at the subject level, as they were missing from the APS data set.

```{r}
sum(is.na(checking_subset2$aps_subject_any_valid)) == nrow(checking_subset2)

sum(is.na(checking_subset2[
  is.na(checking_subset2$aps_subject_any_valid),]$aps_person_id)) == 
  sum(is.na(checking_subset2$aps_subject_any_valid))
```

#### EMS/EMT Intakes Only

The 5 reported observations with a paired EMS/EMT APS Intake were further isolated. This subset contained 5 Subjects and 5 APS Case Numbers.

```{r}
checking_subset2 <- ems_checking_subset %>%
  filter(!is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_case_num)))
```

Within this subset, 3 observations referenced an APS Case Number that had at least one valid determination of elder mistreatment, and 2 observations did not. More broadly, there were 4 observations that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 1 did not.

```{r}
get_unique_value_summary(checking_subset2, c('aps_cases_any_valid','aps_subject_any_valid'))
```

The 5 remaining reported observations without a paired APS Intake were further isolated. This subset contained 2 Subjects.

```{r}
checking_subset2 <- ems_checking_subset %>%
  filter(is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_person_id)))
sum(!is.na(checking_subset2$aps_subject_any_valid))
```

Within this subset, there were 2 negative screenings associated with a subject that had at least one valid allegation of elder mistreatment across the APS data set, and 3 subjects that were missing from the APS data set.

```{r}
get_unique_value_summary(checking_subset2, 'aps_subject_any_valid')
```

### Not Reported

The Negative Screenings where it was indicated that a report was *not* made and no report number was recorded in the DETECT tool were further isolated. This included 23,106 observations of 14,866 Subjects. There were 136 paired APS Intakes for these observations, representing 130 APS Case Numbers.

```{r}
checking_subset <- checking %>%
  filter(detect_report_made == "NO" & is.na(detect_report_num))

nrow(checking_subset)
length(unique(checking_subset$id))
length(unique(na.omit(checking_subset$aps_row)))
length(unique(na.omit(checking_subset$aps_case_num)))
```

When looking specifically only for explicit EMS/EMT APS Intakes, we had 4 paired APS Intakes representing 4 APS Case Numbers.

```{r}
ems_checking_subset <- ems_checking %>%
  filter(detect_report_made == "NO" & is.na(detect_report_num))

nrow(ems_checking_subset)
length(unique(ems_checking_subset$id))
length(unique(na.omit(ems_checking_subset$aps_row)))
length(unique(na.omit(ems_checking_subset$aps_case_num)))
```

#### All Paired APS Intakes

The 136 non-reported observations with a paired APS Intake were further isolated. This subset contained 127 Subjects and 130 APS Case Numbers.

```{r}
checking_subset2 <- checking_subset %>%
  filter(!is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_case_num)))
```

Within this subset, 97 observations referenced an APS Case Number that had at least one valid determination of elder mistreatment, and 39 observations did not. More broadly, there were 110 observations that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 26 did not.

```{r}
get_unique_value_summary(checking_subset2, c('aps_cases_any_valid','aps_subject_any_valid'))
```

The 22,970 remaining reported observations without a paired APS Intake were further isolated. This subset contained 14,831 Subjects.

```{r}
checking_subset2 <- checking_subset %>%
  filter(is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_person_id)))
sum(!is.na(checking_subset2$aps_subject_any_valid))
```

Within this subset, there were 144 observations that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 24 were not. The remaining 325 observations did not have any determinations made at the subject level, as they were missing from the APS data set.

```{r}
get_unique_value_summary(checking_subset2, c('aps_subject_any_valid'))
```

```{r}
sum(is.na(checking_subset2[
  is.na(checking_subset2$aps_subject_any_valid),]$aps_person_id)) == 
  sum(is.na(checking_subset2$aps_subject_any_valid))
```

#### EMS/EMT Intakes Only

The 4 non-reported observations with a paired EMS/EMT APS Intake were further isolated. This subset contained 4 Subjects and 4 APS Case Numbers.

```{r}
checking_subset2 <- ems_checking_subset %>%
  filter(!is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_case_num)))
```

Within this subset, 3 observations referenced an APS Case Number that had at least one valid determination of elder mistreatment, and 1 observation did not. This was the same at the subject level.

```{r}
get_unique_value_summary(checking_subset2, c('aps_cases_any_valid','aps_subject_any_valid'))
```

The 23,102 remaining reported observations without a paired EMS/EMT APS Intake were further isolated. This subset contained 14,866 Subjects.

```{r}
checking_subset2 <- ems_checking_subset %>%
  filter(is.na(aps_row))

nrow(checking_subset2)
length(unique(checking_subset2$id))
length(unique(na.omit(checking_subset2$aps_row)))
length(unique(na.omit(checking_subset2$aps_person_id)))
sum(!is.na(checking_subset2$aps_subject_any_valid))
```

Within this subset, there were 2,892 observations that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 1,148 were not. The remaining 19,062 observations did not have any determinations made at the subject level, as they were missing from the APS data set.

```{r}
get_unique_value_summary(checking_subset2, c('aps_subject_any_valid'))
```

```{r}
sum(is.na(checking_subset2[
  is.na(checking_subset2$aps_subject_any_valid),]$aps_person_id)) == 
  sum(is.na(checking_subset2$aps_subject_any_valid))
```

### Missing Indicator of Report

The Negative Screenings where it was neither indicated a report was or was not made (missing value) nor had a report number recorded in the DETECT tool were further isolated. This included 20 observations of 20 Subjects. There were no paired APS Intakes for these observations.

```{r}
checking_subset <- checking %>%
  filter(is.na(detect_report_made) & is.na(detect_report_num))

nrow(checking_subset)
length(unique(checking_subset$id))
length(unique(na.omit(checking_subset$aps_row)))
length(unique(na.omit(checking_subset$aps_case_num)))
```

This was identical when restricting to EMS/EMT APS Intakes only.

```{r}
checking_subset <- ems_checking %>%
  filter(is.na(detect_report_made) & is.na(detect_report_num))

nrow(checking_subset)
length(unique(checking_subset$id))
length(unique(na.omit(checking_subset$aps_row)))
length(unique(na.omit(checking_subset$aps_case_num)))
```

Within this subset, there was 1 observation that referenced a subject that had at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response). The remaining 19 observations did not have any determinations made at the subject level, as the subjects were missing from the APS data set.

```{r}
get_unique_value_summary(checking_subset, c('aps_subject_any_valid'))
```

## Not Screened

The 4,221 Responses which were not screened represented 2,769 Subjects.

```{r}
checking <- no_screen
ems_checking <- ems_no_screen

nrow(checking)
length(unique(checking$id))
```

None of these responses had a value indicating that a report was made, or a report number.

```{r}
sum(!is.na(no_screen$detect_report_made))
sum(!is.na(no_screen$detect_report_num))
```

#### All Paired APS Intakes

There were 28 of these Responses with a paired APS Intake, representing 27 APS Cases across 27 Subjects. There were 4,193 Responses without a paired APS Intake.

```{r}
checking_subset <- checking %>%
  filter(!is.na(aps_row))

nrow(checking_subset)
nrow(checking) - nrow(checking_subset)
length(unique(checking_subset$id))
length(unique(checking_subset$aps_row))
length(unique(checking_subset$aps_case_num))
```

Of these APS-matched responses, 24 were associated with an APS Case Number that had at least one valid allegation, 4 which did not have any valid allegations. This was identical at the subject level.

```{r}
get_unique_value_summary(checking_subset, c('aps_cases_any_valid', 'aps_subject_any_valid'))
```

Of the responses that lacked a paired APS intake, 662 were associated with Subject that had at least one valid allegation in the APS data set, and 231 which did not have any valid allegations. The remaining 3,300 observations were not present in the APS data set.

```{r}
checking_subset <- checking %>%
  filter(is.na(aps_row))

get_unique_value_summary(checking_subset, 'aps_subject_any_valid')
```

```{r}
sum(!is.na(checking_subset[
  is.na(checking_subset$aps_subject_any_valid),]$aps_person_id))
```

#### EMS/EMT Intakes Only

There were 7 of these Responses with a paired EMS/EMT APS Intake, representing 7 APS Cases across 7 Subjects. There were 4,214 Responses without a paired APS Intake.

```{r}
checking_subset <- ems_checking %>%
  filter(!is.na(aps_row))

nrow(checking_subset)
nrow(checking) - nrow(checking_subset)
length(unique(checking_subset$id))
length(unique(checking_subset$aps_row))
length(unique(checking_subset$aps_case_num))
```

Of these APS-matched responses, 6 were associated with an APS Case Number that had at least one valid allegation, 1 which did not have any valid allegations. This was the same at the subject level.

```{r}
get_unique_value_summary(checking_subset, c('aps_cases_any_valid', 'aps_subject_any_valid'))
```

Of the 4,214 responses that lacked a paired EMS/EMT APS intake, 681 were associated with Subject that had at least one valid allegation in the APS data set, and 231 which did not have any valid allegations. The remaining 3,300 observations were not present in the APS data set.

```{r}
checking_subset <- ems_checking %>%
  filter(is.na(aps_row))

get_unique_value_summary(checking_subset, 'aps_subject_any_valid')
```

```{r}
sum(!is.na(checking_subset[
  is.na(checking_subset$aps_subject_any_valid),]$aps_person_id))
```

# Subject-Wide Aggregate

## Overview

There were a total of 16,565 Subjects in our subject-wise data set, 1,967 of which were also represented in the APS data set. These Subjects represented a total of 28,228 MedStar Responses, 4,188 APS Intakes, and 3,399 APS Case Numbers.

```{r}
nrow(subj_data)
length(unique(subj_data$id))
sum(subj_data$ms_subj_num_responses)

temp_df <- subj_data %>%
  filter(!is.na(aps_person_id))

length(unique(temp_df$aps_person_id))

sum(subj_data$aps_subject_num_intakes, na.rm=TRUE)
sum(subj_data$aps_subject_num_cases, na.rm=TRUE)
```

## Screen vs No Screen

There were 15,212 subjects which had at least one DETECT tool variable selected. These subjects represented 26,622 MedStar responses, and 24,007 DETECT screenings. Of these, 1,860 subjects were also present in the APS data set, representing 4,005 APS Intakes and 3,242 APS Case Numbers.

```{r}
screened <- subj_data %>%
  filter(detect_screened > 0)

nrow(screened)
sum(screened$ms_subj_num_responses)
sum(screened$detect_screened)

length(unique(screened[!is.na(screened$aps_person_id),]$aps_person_id))
sum(screened$aps_subject_num_intakes, na.rm = TRUE)
sum(screened$aps_subject_num_cases, na.rm = TRUE)
```

There were 1,353 subjects which were never screened with the DETECT tool. These subjects represented 1,606 MedStar responses. Of these, 107 subjects were also present in the APS data set, representing 183 APS Intakes and 157 APS Case Numbers.

```{r}
no_screen <- subj_data %>%
  filter(detect_screened == 0)

nrow(no_screen)
sum(no_screen$ms_subj_num_responses)
sum(no_screen$detect_screened)

length(unique(no_screen[!is.na(no_screen$aps_person_id),]$aps_person_id))
sum(no_screen$aps_subject_num_intakes, na.rm = TRUE)
sum(no_screen$aps_subject_num_cases, na.rm = TRUE)
```

## Screened Positive

The 749 Subjects which had at least one positive screening representing 2,708 MedStar Responses and 2,251 DETECT screenings were further isolated. Of these, 408 were also present in the APS data set, representing 1,151 APS Intakes and 838 APS Case Numbers.

```{r}
checking <- screened %>%
  filter(detect_positive > 0)

nrow(checking)
sum(checking$ms_subj_num_responses)
sum(checking$detect_screened)

length(unique(checking[!is.na(checking$aps_person_id),]$aps_person_id))
sum(checking$aps_subject_num_intakes, na.rm = TRUE)
sum(checking$aps_subject_num_cases, na.rm = TRUE)
```

Of the 749 Subjects which had at least one positive screening, 354 were associated with at least one valid determination of elder mistreatment in the APS data set, and 54 were not. The remaining 341 Subjects were not present in the APS data set. There were 456 Subjects that were not reported to APS, and 293 that were reported at least once.

```{r}
get_unique_value_summary(checking, 
                         c('detect_report_made','aps_subject_any_valid'))
```

```{r}
sum(!is.na(checking[is.na(checking$aps_subject_any_valid),]$aps_person_id))
```

### Reported

The Subjects with at least one Positive Screening that were reported at least once were further isolated. This included 293 Subjects, representing 1,112 Responses and 935 Screenings. There were 295 Subjects also present in the APS data set, representing 821 Intakes and 574 APS Case Numbers.

```{r}
checking_subset <- checking %>%
  filter(detect_report_made > 0)

nrow(checking_subset)
sum(checking_subset$ms_subj_num_responses)
sum(checking_subset$detect_screened)

length(unique(
  checking_subset[!is.na(checking_subset$aps_person_id),]$aps_person_id))
sum(checking_subset$aps_subject_num_intakes, na.rm = TRUE)
sum(checking_subset$aps_subject_num_cases, na.rm = TRUE)
```

Within this subset, there were 238 Subjects with at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 27 did not. The remaining 28 observations did not have any determinations made at the subject level, as they were missing from the APS data set.

```{r}
get_unique_value_summary(checking_subset, 'aps_subject_any_valid')
```

```{r}
sum(is.na(checking_subset[
  is.na(checking_subset$aps_subject_any_valid),]$aps_person_id)) == 
  sum(is.na(checking_subset$aps_subject_any_valid))
```

### Not Reported

The Subjects with at least one Positive Screening that were not recorded as reported in the DETECT tool were further isolated. This included 456 Subjects, representing 1,596 Responses and 1,316 Screenings. There were 143 Subjects also present in the APS data set, representing 330 Intakes and 264 APS Case Numbers.

```{r}
checking_subset <- checking %>%
  filter(detect_report_made == 0)

nrow(checking_subset)
sum(checking_subset$ms_subj_num_responses)
sum(checking_subset$detect_screened)

length(unique(
  checking_subset[!is.na(checking_subset$aps_person_id),]$aps_person_id))
sum(checking_subset$aps_subject_num_intakes, na.rm = TRUE)
sum(checking_subset$aps_subject_num_cases, na.rm = TRUE)
```

Within this subset, there were 116 Subjects with at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 27 did not. The remaining 313 observations did not have any determinations made at the subject level, as they were missing from the APS data set.

```{r}
get_unique_value_summary(checking_subset, 'aps_subject_any_valid')
```

```{r}
sum(is.na(checking_subset[
  is.na(checking_subset$aps_subject_any_valid),]$aps_person_id)) == 
  sum(is.na(checking_subset$aps_subject_any_valid))
```

## Screened Negative

The 14,463 Subjects which had at no positive screening representing 23,914 MedStar Responses and 21,756 DETECT screenings were further isolated. Of these, 1,452 were also present in the APS data set, representing 2,854 APS Intakes and 2,404 APS Case Numbers.

```{r}
checking <- screened %>%
  filter(detect_positive == 0)

nrow(checking)
sum(checking$ms_subj_num_responses)
sum(checking$detect_screened)

length(unique(checking[!is.na(checking$aps_person_id),]$aps_person_id))
sum(checking$aps_subject_num_intakes, na.rm = TRUE)
sum(checking$aps_subject_num_cases, na.rm = TRUE)
```

Of the 14,463 Subjects which had no positive screening, 909 were associated with at least one valid determination of elder mistreatment in the APS data set, and 543 were not. The remaining 13,011 Subjects were not present in the APS data set. There were 14,456 Subjects that were not reported to APS, and 7 that were reported at least once.

```{r}
get_unique_value_summary(checking, 
                         c('detect_report_made','aps_subject_any_valid'))
```

```{r}
sum(!is.na(checking[is.na(checking$aps_subject_any_valid),]$aps_person_id))
```

### Reported

The Subjects with at no Positive Screening that were reported at least once were further isolated. This included 7 Subjects, representing 9 Responses and 9 Screenings. There were 4 Subjects also present in the APS data set, representing 6 Intakes and 5 APS Case Numbers.

```{r}
checking_subset <- checking %>%
  filter(detect_report_made > 0)

nrow(checking_subset)
sum(checking_subset$ms_subj_num_responses)
sum(checking_subset$detect_screened)

length(unique(
  checking_subset[!is.na(checking_subset$aps_person_id),]$aps_person_id))
sum(checking_subset$aps_subject_num_intakes, na.rm = TRUE)
sum(checking_subset$aps_subject_num_cases, na.rm = TRUE)
```

Within this subset, there were 238 Subjects with at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 27 did not. The remaining 28 observations did not have any determinations made at the subject level, as they were missing from the APS data set.

```{r}
get_unique_value_summary(checking_subset, 'aps_subject_any_valid')
```

```{r}
sum(is.na(checking_subset[
  is.na(checking_subset$aps_subject_any_valid),]$aps_person_id)) == 
  sum(is.na(checking_subset$aps_subject_any_valid))
```

### Not Reported

The Subjects with no Positive Screening that were not recorded as reported in the DETECT tool were further isolated. This included 14,456 Subjects, representing 23,905 Responses and 21,747 Screenings. There were 1,448 Subjects also present in the APS data set, representing 2,848 Intakes and 2,399 APS Case Numbers.

```{r}
checking_subset <- checking %>%
  filter(detect_report_made == 0)

nrow(checking_subset)
sum(checking_subset$ms_subj_num_responses)
sum(checking_subset$detect_screened)

length(unique(
  checking_subset[!is.na(checking_subset$aps_person_id),]$aps_person_id))
sum(checking_subset$aps_subject_num_intakes, na.rm = TRUE)
sum(checking_subset$aps_subject_num_cases, na.rm = TRUE)
```

Within this subset, there were 906 Subjects with at least one valid determination of elder mistreatment across any APS Case Number within the APS data set (even if not directly matched to the specific response), and 542 did not. The remaining 13,008 observations did not have any determinations made at the subject level, as they were missing from the APS data set.

```{r}
get_unique_value_summary(checking_subset, 'aps_subject_any_valid')
```

```{r}
sum(is.na(checking_subset[
  is.na(checking_subset$aps_subject_any_valid),]$aps_person_id)) == 
  sum(is.na(checking_subset$aps_subject_any_valid))
```

## Not Screened

Of the 1,353 Subjects which were not screened with the DETECT tool (of which none were reported to APS), 68 were associated with at least one valid determination of elder mistreatment in the APS data set, and 39 were not. The remaining 1,246 Subjects were not present in the APS data set.

```{r}
get_unique_value_summary(no_screen, c('detect_report_made','aps_subject_any_valid'))
```

```{r}
sum(is.na(checking[is.na(checking$aps_subject_any_valid),]$aps_person_id)) == 
  sum(is.na(checking$aps_subject_any_valid))
```

# PLACEHOLDER


# BOTTOM
