---
title: "Creating Patient Symptom Table"
date: "Created: 2019-01-31 <br> Updated: `r Sys.Date()`"
output: 
  html_notebook:
    toc: true
    toc_float: true
    css: custom-css.css
---

# Overview

Details on the construction of the MedStar EPCR Patient symptom table.   126 unique symptoms were recorded for 2853 calls.  A total of 4086 symptoms were recorded among the calls.


# Load packages and data

```{r setup, include=FALSE}
knitr::opts_chunk$set(comment = NA)
Sys.setenv(TZ = "US/Central")
```

```{r message=FALSE}
library(tidyverse)
library(bfuncs)
```

```{r}
symptoms <- feather::read_feather("/Users/jaredwiegand/Desktop/DETECT Repository/symptoms.feather")
```

```{r}
about_data(symptoms) # 28,228 observations and 2 variables
```

[top](#top)

# Find all symptoms

* Figure out how to break character stings into component symptoms   
* Get list of all unique symptoms   
* Turn symptoms into binary variables   
* Create new table of symptoms   
* Create two-way table of symptoms by incident complaint   

```{r}
new <- stringr::str_replace_all("''Nausea (R11.0)'',''Vomiting, unspecified (R11.10)'',''Weakness (R53.1)'',''Other malaise (R53.81)''", "'", "") 
```

```{r}
stringr::str_split(
  "''Nausea (R11.0)'',''Vomiting, unspecified (R11.10)'',''Weakness (R53.1)'',''Other malaise (R53.81)''", 
  "(?<=\\))'',''"
) 
```

# Create List of Unique Symptoms

```{r}
symptom_list <- unique(symptoms$symptoms) %>% 
  stringr::str_split("(?<=\\))'',''") %>% 
  unlist() %>% 
  unique() %>% 
  stringr::str_remove_all("'") %>% 
  unique()
```

Remove NA from symptom list

```{r}
symptom_list <- symptom_list[!is.na(symptom_list)]
```

# Create dummy variables for each symptom, by the same name

```{r}
# symptoms %>%
#   mutate(Missing = if_else(is.na(symptoms),1,0))

```

```{r}
for (i in seq_along(symptom_list)) {
  symptoms[symptom_list[i]] <- NA
}
```

# Assign values for each symptom dummy variable

* Still having issues with assigning values

```{r}
for (i in seq_along(symptom_list)) {
  symptoms[symptom_list[i]] <- if_else(stringr::str_detect(symptoms$symptoms, symptom_list[i]), 1, 0)
}
```

```{r}
View(symptoms)
```







# Session information

[top](#top)

```{r echo=FALSE}
rm(list = ls())
```

```{r echo=FALSE}
sessionInfo()
```