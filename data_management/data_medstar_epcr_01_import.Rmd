---
title: "Importing MedStar Data For Analysis"
date: "Created: 2018-12-18 <br> Updated: `r Sys.Date()`"
---

# Overview

In this file we read-in the raw data we received from MedStar on 2018-03-01

Make sure to connect to the UTHealth server using the path stored in NOTES.

# Load packages

```{r setup, include=FALSE}
knitr::opts_chunk$set(comment = NA)
Sys.setenv(TZ = "US/Central")
```

```{r message=FALSE}
library(dplyr)
```


# Set column names and types

```{r}
col_info <- c( 
  # "col_name",             "col_type"
  "arrival_time",           "date",
  "response_num",           "text",
  "incident_pcr",           "text",
  "incident_complaint",     "text",
  "age",                    "numeric",
  "name_full",              "text",
  "dob",                    "date",
  "address_street",         "text",
  "address_city",           "text",
  "address_state",          "text",
  "address_zip",            "text",
  "gender",                 "text",
  # There is a second age column with the same values as the first age column
  "age_2",                  "skip", 
  "race",                   "text",
  "symptoms",               "text",
  "crew_sig",               "text",
  "disposition",            "text",
  "aps_report_num",         "text",
  "aps_report",             "text",
  "detect_emo_distress",    "text",
  "detect_saving_meds",     "text",
  "detect_taking_meds",     "text",
  "detect_poor_hygiene",    "text",
  "detect_adls",            "text",
  "detect_cg_frustrated",   "text",
  "detect_cg_too_conerned", "text",
  "detect_cg_lack_know",    "text",
  "detect_cg_unengaged",    "text",
  "detect_hoarding",        "text",
  "detect_clothing",        "text",
  "detect_isolated",        "text",
  "detect_safe_env",        "text",
  "detect_unusual_odor",    "text"
)
```


```{r}
medstar_epcr <- readxl::read_excel(
  path = "/Volumes/Detect/one_year_data/medstar_epcr.xlsx",
  col_names = col_info[seq(1, length(col_info), 2)],
  col_types = col_info[seq(2, length(col_info), 2)],
  skip = 1
)
rm(col_info)
```

```{r}
dim(medstar_epcr) # 36,304 observations and 32 variables
```


# Deduplicate rows

```{r}
medstar_epcr %>% 
  group_by_all() %>% 
  filter(n() > 1) %>% 
  count() %>% 
  ungroup() %>% 
  select(`Duplicate Rows` = n) # 596 groups of duplicates
```

I manually inspected the duplicate rows. They appear to be genuine duplicates. Below I will drop the duplicate rows.

```{r}
medstar_epcr <- distinct(medstar_epcr)
```

```{r}
dim(medstar_epcr) # 35,557 observations and 33 variables
```

747 duplicate rows were dropped from the data.


# Save imported data

```{r}
readr::write_rds(medstar_epcr, "/Volumes/DETECT/one_year_data/medstar_epcr_01_import.rds")
```


# Session information

```{r echo=FALSE, eval=FALSE}
rm(list = ls())
```

```{r echo=FALSE}
sessionInfo()
```
